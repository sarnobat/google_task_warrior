<html>
<head>
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"> -->

<script src="jquery/jquery-1.9.1.js"></script>
<script type="text/javascript" src="jquery/purl.js"></script>

<script>

var defaultPostponement;
$(document).ready(function(){

	determineDefaultPostponement: {
		defaultPostponement = $.url().param('defaultPostponement');
		if (defaultPostponement == null || defaultPostponement == '') {
			defaultPostponement = 31;
			history.pushState(null, null, '/not_now?defaultPostponement=' + defaultPostponement) // HTML5
		}
	}
    $.getJSON("http://netgear.rohidekar.com:4456/not_now/items" ,function(result){

		$.each(result, function(i, field){
			var table = "";
			table +='<table>';
			$.each(field, function(k,v){
				if (k == 'daysToPostpone') {
					return;
				}
				var title = (v.title.split(/@/)[0]);
				var title2 = title.replace("Reminder: ","");
				if (v.title.match(/.*Repeating.*/)) {
					title2 = "[Repeating] " + title2;
				}
				table +='<tr id=event-'+k+'>';
				var capitalizedTitle = capitalize(title2);
				var color = 'black';
				if (capitalizedTitle.match(/.*Repeating.*/)) {
					color = '#AAAAAA';
				}
				get_color: {
					var projects = ['yurl', 'coagulate'];
					$.each(projects, function(index, project) {
						if (capitalizedTitle.indexOf(project) != -1) {
						
							console.debug(project);
							console.debug(capitalizedTitle);
							color = '#BBBBBB';
						}
					});
				}
				{
					var projects = ['yurl', 'coagulate'];
					$.each(projects, function(index, project) {
						if (capitalizedTitle.indexOf(project) != -1) {
						
							console.debug(project);
							console.debug(capitalizedTitle);
							color = '#BBBBBB';
						}
					});
				}
				table +='<td>' + k + "</td><td>&nbsp;</td><td style='color : "+color+"'>" + capitalizedTitle + "</td>";
				var quickPostponeAmounts = [1, 4, 7, 15, 30, 60];
				var quickPostponeAmount;
				for(var i in quickPostponeAmounts) {
					var quickPostponeAmount = quickPostponeAmounts[i];
					table +="<td>&nbsp;&nbsp;<button type=button onclick='postpone("+k+","+quickPostponeAmount+")'> " +quickPostponeAmount + " days</button >"+"&nbsp;&nbsp;</td>";
				}
				table +="<td>&nbsp;&nbsp;<button class=defaultpostpone type=button onclick='postponeDefault("+k+")'> " +defaultPostponement + " days</button >"+"&nbsp;&nbsp;</td>";
				table +='</tr>';
			});		
			table +=	'</table>';
			$("#items").append(table);
		});
    });
});

function postpone(itemNumber, daysToPostpone) {
    $.getJSON("http://netgear.rohidekar.com:4456/not_now/postpone?itemNumber=" + itemNumber + "&daysToPostpone=" + daysToPostpone,function(result){
    	console.log("success"); 
    });
    $("#event-" + itemNumber).remove();
    
}

function postponeDefault(itemNumber) {
    $.getJSON("http://netgear.rohidekar.com:4456/not_now/postpone?itemNumber=" + itemNumber + "&daysToPostpone=" + defaultPostponement,function(result){
    	console.log("success2"); 
    });
    $("#event-" + itemNumber).remove();
    defaultPostponement++;
	history.pushState(null, null, '/not_now?defaultPostponement=' + defaultPostponement) // HTML5
	$(".defaultpostpone").text( defaultPostponement +  " days");
}

function capitalize(str) {
    strVal = '';
    str = str.split(' ');
    for (var chr = 0; chr < str.length; chr++) {
        strVal += str[chr].substring(0, 1).toUpperCase() + str[chr].substring(1, str[chr].length) + ' '
    }
    return strVal
}

</script>
</head>
<body>

<div id="items"></div>

</body>
</html>
